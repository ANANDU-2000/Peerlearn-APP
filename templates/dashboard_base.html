<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PeerLearn - One-to-One Live Learning Platform{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>">
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f6ff',
                            100: '#e0edff',
                            200: '#c7dcff',
                            300: '#a0c3ff',
                            400: '#739fff',
                            500: '#4b76ff',
                            600: '#1e3a8a', /* Primary Blue */
                            700: '#1c3178',
                            800: '#1c2860',
                            900: '#1a2452',
                            950: '#111536',
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        [x-cloak] { display: none !important; }
        /* Global styles */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Skeleton loader styles */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
        }
        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        /* Focus styles for accessibility */
        *:focus-visible {
            outline: 2px solid #1e3a8a;
            outline-offset: 2px;
        }
        
        /* Tooltip styles */
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem;
            background-color: #1e3a8a;
            color: white;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            white-space: nowrap;
            z-index: 10;
        }
        
        /* Toast animation */
        @keyframes toast-in {
            0% { transform: translateY(100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes toast-out {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        
        .toast-enter {
            animation: toast-in 0.3s ease-out forwards;
        }
        
        .toast-exit {
            animation: toast-out 0.3s ease-in forwards;
        }
    </style>
    
    <!-- Toast notification script -->
    <script src="{% static 'js/toasts.js' %}"></script>
    
    <!-- Dashboard WebSocket connection script -->
    <script src="{% static 'js/dashboard-ws.js' %}"></script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col bg-gray-50">
    <!-- Store user ID for WebSocket connection -->
    <input type="hidden" id="user-id" value="{{ request.user.id }}">
    
    <!-- WebSocket connection status indicator -->
    <div id="ws-status-indicator" class="fixed bottom-4 right-4 w-3 h-3 rounded-full bg-red-500 z-50" title="Disconnected from real-time updates"></div>
    
    {% include 'includes/dashboard_header.html' %}
    
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>
    
    {% if user.is_authenticated and user.is_learner %}
        {% include 'includes/mobile_bottom_nav.html' %}
    {% endif %}
    
    {% include 'includes/footer.html' %}
    {% include 'includes/toasts.html' %}
    {% include 'includes/modals.html' %}
    
    <!-- Initialize Feather Icons and Alpine.js -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();
            
            // Initialize mobile navigation tabs
            if (typeof window.initializeAlpineData === 'function') {
                const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
                const activeTab = window.getActiveTabFromURL ? window.getActiveTabFromURL() : 'home';
                
                // Set initial active state
                mobileNavItems.forEach(item => {
                    if (item.dataset.tab === activeTab) {
                        item.classList.add('text-primary-600');
                        item.classList.remove('text-gray-500');
                    } else {
                        item.classList.remove('text-primary-600');
                        item.classList.add('text-gray-500');
                    }
                });
            }
        });
    </script>
    
    <!-- Core JS libraries -->
    {% if user.is_authenticated %}
    <script src="{% static 'js/toasts.js' %}"></script>
    <script src="{% static 'js/notifications.js' %}"></script>
    <script src="{% static 'js/dashboard-ws.js' %}"></script>
    {% endif %}
    
    {% block extra_js %}{% endblock %}
</body>
</html>